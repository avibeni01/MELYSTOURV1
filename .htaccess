# Elynor Tours - Next.js Static Export Configuration
# Date: 3 novembre 2025
# Domaine: https://elynortours.com

# =====================================
# 1. HTTPS & WWW Redirect
# =====================================
RewriteEngine On

# Force HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Redirect www to non-www (ou inverse selon préférence)
RewriteCond %{HTTP_HOST} ^www\.elynortours\.com [NC]
RewriteRule ^(.*)$ https://elynortours.com/$1 [L,R=301]

# Support melystour.com aussi
RewriteCond %{HTTP_HOST} ^(www\.)?melystour\.com [NC]
RewriteRule ^(.*)$ https://elynortours.com/$1 [L,R=301]

# =====================================
# 2. URLs Propres Next.js
# =====================================
# Permet /hotels/tel-aviv au lieu de /hotels/tel-aviv.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.*)$ $1.html [L]

# =====================================
# 3. Page d'Erreur 404
# =====================================
ErrorDocument 404 /404.html

# =====================================
# 4. Compression GZIP
# =====================================
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml image/svg+xml
</IfModule>

# =====================================
# 5. Mise en Cache Navigateur
# =====================================
<IfModule mod_expires.c>
  ExpiresActive On

  # Images - 1 an
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"

  # CSS et JavaScript - 1 mois
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType application/x-javascript "access plus 1 month"

  # HTML - 1 heure (pour updates rapides)
  ExpiresByType text/html "access plus 1 hour"

  # Autres
  ExpiresByType application/pdf "access plus 1 month"
  ExpiresByType application/font-woff "access plus 1 year"
  ExpiresByType application/font-woff2 "access plus 1 year"
</IfModule>

# =====================================
# 6. Sécurité Headers
# =====================================
<IfModule mod_headers.c>
  # Protection XSS
  Header set X-XSS-Protection "1; mode=block"

  # Empêcher MIME sniffing
  Header set X-Content-Type-Options "nosniff"

  # Clickjacking protection
  Header set X-Frame-Options "SAMEORIGIN"

  # HSTS - Force HTTPS pour 1 an
  Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"

  # Referrer Policy
  Header set Referrer-Policy "strict-origin-when-cross-origin"

  # Content Security Policy (permissif pour iframe Vercel)
  Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://elynor-location.vercel.app https://connect.facebook.net; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: http:; font-src 'self' data:; frame-src https://elynor-location.vercel.app; connect-src 'self' https://elynor-location.vercel.app https://api.hubapi.com"
</IfModule>

# =====================================
# 7. Désactiver Listing Répertoires
# =====================================
Options -Indexes

# =====================================
# 8. Bloquer Fichiers Sensibles
# =====================================
# Bloquer fichiers cachés (.git, .env, etc)
<FilesMatch "^\.">
  Require all denied
</FilesMatch>

# Bloquer fichiers Node.js
<FilesMatch "(package\.json|package-lock\.json|tsconfig\.json|next\.config\.js|\.env|\.env\.local|node_modules)">
  Require all denied
</FilesMatch>

# Bloquer fichiers de backup
<FilesMatch "\.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist)$">
  Require all denied
</FilesMatch>

# =====================================
# 9. Support UTF-8
# =====================================
AddDefaultCharset UTF-8
AddCharset UTF-8 .html .css .js .xml .json .rss .atom

# =====================================
# 10. MIME Types
# =====================================
<IfModule mod_mime.c>
  AddType application/javascript .js
  AddType application/json .json
  AddType image/svg+xml .svg .svgz
  AddType image/webp .webp
  AddType font/woff .woff
  AddType font/woff2 .woff2
</IfModule>

# =====================================
# 11. Remove Server Signature
# =====================================
ServerSignature Off

# =====================================
# 12. Sitemap & Robots
# =====================================
# Assurer que sitemap.xml et robots.txt sont accessibles
<Files "sitemap.xml">
  Require all granted
</Files>

<Files "robots.txt">
  Require all granted
</Files>

# =====================================
# FIN - Elynor Tours Configuration
# =====================================
